#!/bin/sh

case "$1" in
  start)
    G_FILENAME_ENCODING="UTF-8,ISO-8859-1"

    DBUS_SERVICE=`dbus-launch --sh-syntax`
    echo $DBUS_SERVICE > /var/run/raumfeld.session
    eval $DBUS_SERVICE

    if [ -e /sys/module/mwifiex ]; then
        iw dev wlan0 interface add uap0 type __ap
    fi

    connmanctl enable wifi

    echo "starting logger"
    mknod /var/run/raumfeld-setup-logger-pipe pipe
    logger -t "raumfeld" < /var/run/raumfeld-setup-logger-pipe &

    echo "starting raumfeld-setup"
    cd /raumfeld/raumfeld-setup
    ./raumfeld-setup --verbose > /var/run/raumfeld-setup-logger-pipe 2>&1 &
    ;;
  *)
    ;;
esac

exit $?
