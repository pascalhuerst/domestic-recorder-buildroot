#!/bin/sh

. ../tests.inc
TITLE="ETHADDR"
DIALOGOPTS="--title $TITLE"


eval $(fw_printenv | grep ^ethaddr)
if [ ! -z "$ethaddr" ]; then
	/sbin/ifconfig eth0 hw ether $ethaddr
	dialog_info "Ethernet MAC address already set: $ethaddr" $DIALOGOPTS
	exit 0
fi

dialog_info "Obtaining Ethernet MAC address. Please wait." $DIALOGOPTS

ethaddr=$(wget -q -O - http://$TEST_HOST_WIRELESS/cgi-bin/getmac)
if [ -z "$ethaddr" ]; then
	dialog_err "UNABLE TO GET MAC ADDRESS! PLEASE SYNC TEST MACHINE."
	exit -1
fi

fw_setenv ethaddr $ethaddr
/sbin/ifconfig eth0 hw ether $ethaddr

dialog_success "MAC address: $ethaddr" $DIALOGOPTS
exit 0

